# Bitmask DP & [toi20_bit_string](https://programming.in.th/tasks/toi20_bit_string/)
---
## Problem
### ‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏à‡∏ó‡∏¢‡πå
‡πÄ‡∏£‡∏≤‡∏°‡∏µ Binary String (‡∏™‡∏ï‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ '1' ‡πÅ‡∏•‡∏∞ '0' ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô) ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß $N$ ‡∏ã‡∏∂‡πà‡∏á‡∏´‡∏≤‡∏Å‡πÄ‡∏£‡∏≤‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ String ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß $N$ ‡∏ó‡∏∏‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ‡∏à‡∏∞‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ $2^N$ ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ‡πÇ‡∏î‡∏¢‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ‡∏à‡∏∞‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å $C_i$

‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏ó‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô '1' ‡πÄ‡∏õ‡πá‡∏ô '0' ‡∏ã‡∏∂‡πà‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡πÑ‡∏î‡πâ 2 ‡∏ß‡∏¥‡∏ò‡∏µ
1. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô '1' ‡πÄ‡∏õ‡πá‡∏ô '0'
2.  ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô '11' (‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞ '1' ‡∏™‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô) ‡πÄ‡∏õ‡πá‡∏ô '00' (‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞ '0' ‡∏™‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô)

‡πÇ‡∏î‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ Binary String ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô '1' ‡πÄ‡∏õ‡πá‡∏ô '0' ‡πÄ‡∏£‡∏≤‡∏à‡∏∞**‡∏ö‡∏ß‡∏Å‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏Ç‡∏≠‡∏á Binary String ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏±‡πâ‡∏ô** ‡πÑ‡∏õ‡∏Å‡∏±‡∏ö **"‡∏Ñ‡πà‡∏≤‡∏•‡∏î‡∏ó‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û"** 
‡πÅ‡∏•‡πâ‡∏ß Operation ‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡∏à‡∏ö‡∏•‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ String ‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô "00000........0" ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ **‡∏Ñ‡πà‡∏≤‡∏•‡∏î‡∏ó‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û** ‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

### **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏ó‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û**
$N = 3$<br>
$001 = 9$<br>
$000 = 0$<br>
$100 = 9$<br>
$010 = 1$<br>
$101 = 1$<br>
$110 = 2$<br>
$111 = 3$<br>
$011 = 1$<br>

Binary String ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ: $111$

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:**
‡∏Ñ‡πà‡∏≤‡∏•‡∏î‡∏ó‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà $C_{111}$ = 3<br>
1. 111 -> 011 : $ans$ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏õ $C_{011}$ = 1 -> 4<br>
2. 011 -> 001 : $ans$ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏õ $C_{001}$ = 9 -> 13<br>

‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á Binary String $111$ ‡∏Ñ‡∏∑‡∏≠ 13

‡πÇ‡∏î‡∏¢‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏à‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î Binary String ‡∏°‡∏≤‡πÉ‡∏´‡πâ $Q$ ‡∏≠‡∏±‡∏ô ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö
### ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥
‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤ **‡∏Ñ‡πà‡∏≤‡∏•‡∏î‡∏ó‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û** ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Binary String ‡∏ó‡∏±‡πâ‡∏á $Q$ ‡∏≠‡∏±‡∏ô
!!! note "Constraints"
    - $2 \leq N \leq 20$
    - $-500,000 \leq C_i \leq 1,000,000$
!!! note "Prerequisites"
    - Bitmasks
    - Dynamic Programming
---
## Bitmask DP
‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ Bitmask DP ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Dynamic Programming ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏û‡∏¥‡∏™‡∏î‡∏≤‡∏£‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ 

‡πÇ‡∏î‡∏¢ Bitmask DP ‡∏ô‡∏±‡πâ‡∏ô ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö **‡πÄ‡∏•‡∏Ç‡∏ê‡∏≤‡∏ô‡∏™‡∏≠‡∏á** ‡∏ã‡∏∂‡πà‡∏á‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö DP ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ Index ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö DP ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ Mask (‡πÄ‡∏•‡∏Ç‡∏ê‡∏≤‡∏ô‡∏™‡∏≠‡∏á) ‡πÅ‡∏ó‡∏ô ‡∏ô‡∏±‡πà‡∏ô‡∏Ñ‡∏∑‡∏≠ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î $2^N$ Mask (‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏Ç‡∏ê‡∏≤‡∏ô‡∏™‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ $N$ ‡∏´‡∏•‡∏±‡∏Å)

‡πÇ‡∏î‡∏¢‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö State DP ‡πÉ‡∏ô‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Ç‡∏≠‡∏á 
- $dp[mask] =$ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥ operation ‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏•‡∏á‡∏ó‡∏µ‡πà state ‡∏ó‡∏µ‡πà $mask$ ‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- $dp[mask] =$ min/max value ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ô‡∏≥‡∏û‡∏≤‡πÄ‡∏£‡∏≤‡∏°‡∏≤‡∏¢‡∏±‡∏á state ‡∏ó‡∏µ‡πà $mask$

‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Bitmask DP ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏Ñ‡∏∑‡∏≠<br>
1. loop ‡∏ï‡∏≤‡∏°‡∏ó‡∏∏‡∏Å‡πÜ $mask$ ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ $O(2^N)$<br>
2. ‡∏•‡∏π‡∏õ‡∏ï‡∏≤‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÉ‡∏ô $mask$ ‡∏ô‡∏±‡πâ‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ä‡πá‡∏Å‡∏ß‡πà‡∏≤ ‡∏´‡∏≤‡∏Å‡∏™‡∏±‡∏ö bit ‡∏ô‡∏±‡πâ‡∏ô‡∏≠‡∏≠‡∏Å $(1 > 0)$ ‡πÅ‡∏•‡πâ‡∏ß $dp$ ‡∏Ç‡∏≠‡∏á state ‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏Ñ‡∏¢‡∏ó‡∏≥‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏°‡∏±‡πâ‡∏¢ ‡∏î‡∏±‡∏á‡∏£‡∏π‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏∏‡∏Å bit ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô 1 ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô 0 ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ä‡πá‡∏Å)<br>
<div class="bitmask-container">
<img src="https://i.ibb.co/6RKWGJ6n/Screenshot-2025-08-23-123831.png" class="bitmask_dp"><br>
</div>
3.
‡∏´‡∏≤‡∏Å‡∏ó‡∏≥‡πÑ‡∏î‡πâ ‡∏Å‡πá‡πÄ‡∏≠‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤ cost function ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô $dp[mask]$ ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

‡πÇ‡∏î‡∏¢‡πÉ‡∏ô‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞ DP ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 2 ‡∏ô‡∏±‡πà‡∏ô‡∏Ñ‡∏∑‡∏≠ $dp[mask] =$ ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ô‡∏≥‡πÄ‡∏£‡∏≤‡∏°‡∏≤‡∏¢‡∏±‡∏á state ‡∏ó‡∏µ‡πà $mask$

---
## Solution
### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥
‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÄ‡∏£‡∏≤‡∏Å‡πá‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö input ‡∏ß‡πà‡∏≤ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ $mask$ ‡∏Ñ‡πà‡∏≤‡∏•‡∏î‡∏ó‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏°‡∏±‡∏ô‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà ‡πÄ‡∏£‡∏≤‡∏Å‡πá‡∏à‡∏∞‡∏£‡∏±‡∏ö input ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô Binary String ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡πÄ‡∏Ç‡πâ‡∏≤ function $binary$ ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á Binary String ‡πÄ‡∏õ‡πá‡∏ô ‡πÄ‡∏•‡∏Ç‡∏ê‡∏≤‡∏ô‡∏™‡∏¥‡∏ö

‡∏´‡∏•‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏£‡∏≤‡∏Å‡πá‡πÅ‡∏Ñ‡πà‡∏ô‡∏≥‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏Ç‡∏≠‡∏á Bitmask DP ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô ‡∏•‡∏á‡∏°‡∏≤‡πÉ‡∏ä‡πâ ‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏ß‡πà‡∏≤ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö $dp[mask]$ ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà ‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡∏≤‡∏à‡∏∞ Loop ‡πÑ‡∏õ‡∏ó‡∏∏‡∏Å‡πÜ $mask$ (‡∏ô‡∏±‡πà‡∏ô‡∏Ñ‡∏∑‡∏≠ ‡∏ß‡∏ô $2^N$ ‡∏£‡∏≠‡∏ö) ‡πÇ‡∏î‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ $mask$ ‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:<br>
**Loop ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 1 (‡∏™‡∏±‡∏ö‡∏≠‡∏≠‡∏Å 1 bit)**

- ‡πÄ‡∏ä‡πá‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞ index ‡∏ß‡πà‡∏≤ $mask$ ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà $i$ ‡πÄ‡∏õ‡πá‡∏ô 1 ‡∏´‡∏£‡∏∑‡∏≠ 0
    - ‡∏´‡∏≤‡∏Å‡πÄ‡∏õ‡πá‡∏ô 0 ‡∏Å‡πá‡∏Ç‡πâ‡∏≤‡∏°  
    - ‡∏´‡∏≤‡∏Å‡πÄ‡∏õ‡πá‡∏ô 1 ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏≤ bit ‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0 (‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ $nm$ ‡∏¢‡πà‡∏≠‡∏à‡∏≤‡∏Å $new mask$) ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá  
      ‡πÄ‡∏Å‡πá‡∏ö $dp[mask] = \max(dp[mask], dp[nm] + a[mask])$ ‡∏ã‡∏∂‡πà‡∏á‡∏Ñ‡∏∑‡∏≠ cost function ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤

**Loop ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 2 (‡∏™‡∏±‡∏ö‡∏≠‡∏≠‡∏Å 2 bit)**

- ‡πÄ‡∏ä‡πá‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞ index ‡∏ß‡πà‡∏≤ $mask$ ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà $i$ ‡πÅ‡∏•‡∏∞ $i+1$ ‡πÄ‡∏õ‡πá‡∏ô 1 ‡∏´‡∏£‡∏∑‡∏≠ 0
    - ‡∏´‡∏≤‡∏Å‡∏™‡∏±‡∏Å‡∏≠‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0 ‡∏Å‡πá‡∏Ç‡πâ‡∏≤‡∏°  
    - ‡∏´‡∏≤‡∏Å‡πÄ‡∏õ‡πá‡∏ô 1 ‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á bit ‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0 (‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ $nm$ ‡∏¢‡πà‡∏≠‡∏à‡∏≤‡∏Å $new mask$) ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá  
      ‡πÄ‡∏Å‡πá‡∏ö $dp[mask] = \max(dp[mask], dp[nm] + a[mask])$

‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏°‡∏≤ ‡πÄ‡∏£‡∏≤‡∏Å‡πá‡πÅ‡∏Ñ‡πà‡∏™‡πà‡∏á Output ‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô $dp[input]$ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢

---
### Code
```cpp title="toi20_bit_string.cpp"
#include <bits/stdc++.h>

using namespace std;

const long long mod = 1e9 + 7;
const long long inf = 1e18;

long long binary(string s){
    long long ans = 0;
    reverse(all(s));
    for (long long i = 0; i < s.length(); i++) {
        ans += (s[i] - '0') * (1 << i);
    }
    return ans;
}

int32_t main(){
    cin.tie(NULL)->sync_with_stdio(false);
    long long n, q; cin >> n >> q;
    vector <long long> a(1 << n);
    for (long long i = 0; i < (1 << n); i++) {
        string s; cin >> s;
        long long num; cin >> num;
        a[binary(s)] = num;
    }
    vector <long long> dp(1 << n, -inf); dp[0] = 0;
    for (long long mask = 1; mask < (1 << n); mask++) {
        // swap 1 bit
        for (long long i = 0; i < n; i++) {
            if ((mask & (1 << i)) == 0) continue;
            long long nm = mask ^ (1 << i);
            dp[mask] = max(dp[mask], dp[nm] + a[mask]);
        }
        // swap 2 bits
        for (long long i = 0; i < n - 1; i++) {
            if ((mask & (1 << i)) == 0 || (mask & (1 << (i + 1))) == 0) continue;
            long long nm = mask ^ (1 << i) ^ (1 << (i + 1));
            dp[mask] = max(dp[mask], dp[nm] + a[mask]);
        }
    }
    while (q--) {
        string s; cin >> s;
        cout << dp[binary(s)] << "\n";
    }
}
```

!!! note "Total Time Complexity"  
    $O(2^N \cdot N)$

‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢ comment ‡πÑ‡∏ß‡πâ‡πÉ‡∏ï‡πâ [post](https://web.facebook.com/share/p/199k1dF8Ld/) ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö üôá‚Äç‚ôÇÔ∏èüôá‚Äç‚ôÇÔ∏è  